âŸ¨Val, Add, Sub, Pow, BackwardâŸ© â† â€¢Import "value.bqn"
âŸ¨Last, _lâŸ© â† â€¢Import "util.bqn"
âŸ¨MLP, Address, _bindCallâŸ© â† â€¢Import "mlp.bqn"

shape â† 3â€¿4â€¿4â€¿1
input â† âŸ¨2,3,Â¯1âŸ©â€¿âŸ¨3,Â¯1,0.5âŸ©â€¿âŸ¨0.5,1,1âŸ©â€¿âŸ¨1,1,Â¯1âŸ©
truth â† 1â€¿Â¯1â€¿Â¯1â€¿1

nn â† MLP shape
offsets â† 93â€¿146â€¿199â€¿252 #???

Call â† (Address shape) _bindCall

Loss â† {
  m â† ğ•© Val _l truth
  m Sub _lâ†© offsets â‹ˆÂ¨ m Last si â† â‰ input
  m Val _lâ†© si/â‰2
  m Pow _lâ†© (si -Ëœ 2â€¿5â€¿8â€¿11 âŠ m Last 3 Ã— si) â‹ˆÂ¨ m Last si #???
  m Add m Last si
}

Descent â† (â‰ nn)âŠ¸{
  m â† (ğ•¨â†‘ğ•©) Call input
  m â†© 0Ë˜âŒ¾(1âŠ¸âŠË˜) Loss m
  m Backwardâ†© 1 -Ëœ â‰ m
  (âŠ¢â‹ˆËœâŠ£+Â¯0.2âŠ¸Ã—)Â´Ë˜âŒ¾(2âŠ¸â†‘Ë˜ğ•¨âŠ¸â†‘) m
}

â€¢Out "ground truth:"
â€¢Show truth
â€¢Out "initial classification:"
â€¢Show âŠ‘Ë˜ offsets âŠ nn Call input
â€¢Out "after training:"
â€¢Show âŠ‘Ë˜ offsets âŠ DescentâŸ20 nn
