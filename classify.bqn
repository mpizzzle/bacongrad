âŸ¨Init, Val, Add, Sub, Mul, Pow, Tanh, BackwardâŸ© â† â€¢Import "value.bqn"

Rand â† (1 -Ëœ 2 Ã— â€¢rand.RangeâŠ¸Ã·) 1 -Ëœ 2 â‹† 32Ë™
Ranges â† Ã—Â´Ë˜ 1â€¿0 +â‰1 2âŠ¸â†•
Group â† âŒŠâˆ˜Ã·ËœâŸœ(â†•â‰ )âŠ”âŠ¢
Ind â† â‰ âŠ¸+âŸœâ†•-âŠ¢

Layer â† {
  matty â† ğ•¨
  inâ€¿out â† ğ•©
  sinâ€¿sout â† in â‹ˆâ—‹â‰  out
  weightsâ€¿biases â† sin (âˆ¾Â¨ â†‘Â¨ â‹ˆ Â¯1âŠ¸â†‘Â¨) out

  matty MulËœÂ´â†© âŒ½ weights â‰Â¨Ëœ âˆ¾ sout / â‹ˆ in
  matty AddËœÂ´â†© âŒ½ biases âˆ¾Â¨ sin Group matty Ind sin Ã— sout
  matty TanhËœÂ´â†© âŒ½ matty Ind sout
}

shape â† 3â€¿4â€¿4â€¿1
input â† âŸ¨2,3,Â¯1âŸ©â€¿âŸ¨3,Â¯1,0.5âŸ©â€¿âŸ¨0.5,1,1âŸ©â€¿âŸ¨1,1,Â¯1âŸ©
truth â† 1â€¿Â¯1â€¿Â¯1â€¿1
mlp â† âˆ¾ Initâˆ˜RandÂ¨ â†• +Â´ Ranges shape
params â† â‰ mlp
offsets â† 1 -Ëœ params + (1+â†•4) Ã— 4 Ã·Ëœ params -Ëœ 253 #???
address â† (âŒ½ Â¯1âŠ¸â†“ (âŠ£ â‹ˆ 1âŠ¸+âŠ¸Group)Â¨âŸœ(â†•Â¨++`âŠ¸-) Ranges) shape

Call â† ValËœÂ´âŸœâŒ½Ëœ (âŠ¢ Layer IndâŸœâŠ‘Ëœ â‹ˆ 1âŠ¸âŠ‘Ëœ)Â´ addressË™

Loss â† { #truth, offsets, matty ???
  matty â† ğ•©
  matty ValËœÂ´â†© âŒ½ truth
  matty SubËœÂ´â†© âŒ½ offsets â‹ˆÂ¨ matty Ind 4
  subs â† 2â€¿5â€¿8â€¿11 âŠ matty Ind 12 #???
  matty ValËœÂ´â†© âŒ½ 4/â‰2
  matty PowËœÂ´â†© âŒ½ subs â‹ˆÂ¨ matty Ind 4
  matty Add âŒ½ matty Ind 4
}

Desc â† {
  matty â† ğ•©
  matty â†© (âŠ¢â‹ˆËœâŠ£+Â¯0.2âŠ¸Ã—)Â´Ë˜âŒ¾(2âŠ¸â†‘Ë˜) paramsâŠ¸â†‘ matty
  matty CallÂ´â†© âŒ½ input
  matty â†© Loss matty
  matty â†© 0Ë˜âŒ¾(1âŠ¸âŠË˜) matty
  matty Backwardâ†© 1 -Ëœ â‰ matty
}

â€¢Out "ground truth:"
â€¢Show truth
â€¢Out "initial classification:"
â€¢Show âŠ‘Ë˜ offsets âŠ mlp CallÂ´ âŒ½ input
â€¢Out "after training:"
â€¢Show âŠ‘Ë˜ offsets âŠ DescâŸ20 mlp
