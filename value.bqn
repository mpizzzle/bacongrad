Init â‡ { â‰ ğ•©â€¿0â€¿0â€¿âŸ¨âŸ© }
Val â‡ âˆ¾âŸœInit
TopoSort â‡ â· { ğ•© âˆ¾Ëœ âˆ¾ğ•¨ ğ•Šâš‡2â€¿0 Â¯1 âŠ‘ ğ•© âŠ ğ•¨ }

_apply â† {
  children â† â¥Šğ•©
  value â† ğ”½ âŠ‘Ë˜ children âŠ ğ•¨
  op â† âŠ‘ / ğ•— = f_ops
  ğ•¨ âˆ¾ â‰ valueâ€¿0â€¿opâ€¿children
}

_compose_ â† { (ğ•¨ ğ”½ 1âŠ‘ğ•©) ğ”¾ (âŠ‘ğ•©) â‹ˆ 1 + â‰ ğ•¨ }

Add â‡ (AddF â† +Â´)_apply
Mul â‡ (MulF â† Ã—Â´)_apply
Pow â‡ (PowF â† â‹†Â´)_apply
Exp â‡ (ExpF â† âŠ‘ â‹†)_apply
Tanh â‡ (TanhF â† âŠ‘ â€¢math.Tanh)_apply

Neg â‡ ValâŸœÂ¯1 Mul â‹ˆâŸœâ‰ Ëœ
Rec â‡ ValâŸœÂ¯1 Pow â‹ˆâŸœâ‰ Ëœ
Sub â‡ Neg _compose_ Add
Div â‡ Rec _compose_ Mul

_monad â† { ğ”½Â´ 2 â†‘ ğ•© }
_dyad â† { (ğ”½ ğ•¨) Ã— 1 âŠ‘ ğ•© }
_derive â† {
  outâ€¿children â† ğ•¨
  grads â† children ğ”½â—‹(âŠâŸœğ•©) out
  gradsâŠ¸+âŒ¾(1âŠ¸âŠË˜childrenâŠ¸âŠ) ğ•©
}

ExpB â† Ã—_monad _derive
TanhB â† (âŠ¢Ã—1-2â‹†ËœâŠ£)_monad _derive
AddB â† 1Ë™_dyad _derive
MulB â† (âŒ½âŠ‘Ë˜)_dyad _derive
PowB â† ((âŠ¢Ã—âŠ£â‹†1-ËœâŠ¢)Â´âŠ‘Ë˜)_dyad _derive # with respect to base only

f_ops â† âŠ¢â€¿AddFâ€¿MulFâ€¿PowFâ€¿ExpFâ€¿TanhF
b_ops â† âŠ¢â€¿AddBâ€¿MulBâ€¿PowBâ€¿ExpBâ€¿TanhB

Propagate â† {
  opâ€¿ch â† 2â€¿3 âŠ ğ•¨ âŠ ğ•©
  ğ•¨ â‹ˆâŸœchâŠ¸(op â—¶ b_ops) ğ•©
}

InitGrad â† { 1âŒ¾(1âŠ¸âŠ‘ ğ•©âŠ¸âŠ) ğ•¨ }
Backward â‡ âŠ£ (InitGradâŸœ(Â¯1âŠ¸âŠ‘) PropagateÂ´ âŠ¢) TopoSort
