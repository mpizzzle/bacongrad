_monad ← {
  out‿children ← 𝕨
  grads ← 𝔽´ 2 ↑ out ⊏ 𝕩
  grads⊸+⌾(1⊸⊏˘children⊸⊏) 𝕩
}

_dyad ← {
  out‿children ← 𝕨
  grads ← (1 ⊑ out ⊏ 𝕩) × 𝔽 children ⊏ 𝕩
  grads⊸+⌾(1⊸⊏˘children⊸⊏) 𝕩
}

_compose_ ← {
  a‿b ← 𝕩
  (𝕨 𝔽 b) 𝔾 a ⋈ 1 + ≠𝕨
}

_apply ← {
  children ← ⥊𝕩
  value ← 𝔽 ⊑˘ children ⊏ 𝕨
  op ← ⊑ / 𝕗 = f_ops
  𝕨 ∾ ≍ value‿0‿op‿children
}

Add ⇐ (AddF ← +´)_apply
Mul ⇐ (MulF ← ×´)_apply
Pow ⇐ (PowF ← ⋆´)_apply
Exp ⇐ (ExpF ← ⊑ ⋆)_apply
Tanh ⇐ (TanhF ← ⊑ •math.Tanh)_apply

Init ⇐ { ≍ 𝕩‿0‿0‿⟨⟩ }
Val ⇐ ∾⟜Init
Neg ⇐ Val⟜¯1 Mul ⋈⟜≠˜
Rec ⇐ Val⟜¯1 Pow ⋈⟜≠˜
Sub ⇐ Neg _compose_ Add
Div ⇐ Rec _compose_ Mul
TopoSort ⇐ ⍷ { 𝕩 ∾˜ ∾𝕨 𝕊⚇2‿0 ¯1 ⊑ 𝕩 ⊏ 𝕨 }

ExpB ← ×_monad
TanhB ← (⊢×1-2⋆˜⊣)_monad
AddB ← 1˙_dyad
MulB ← (⌽⊑˘)_dyad
PowB ← ((⊢×⊣⋆1-˜⊢)´⊑˘)_dyad

f_ops ← ⊢‿AddF‿MulF‿PowF‿ExpF‿TanhF
b_ops ← ⊢‿AddB‿MulB‿PowB‿ExpB‿TanhB

Propagate ← {
  op‿ch ← 2‿3 ⊏ 𝕨 ⊏ 𝕩
  𝕨 ⋈⟜ch⊸(op ◶ b_ops) 𝕩
}

InitGrad ← { 1⌾(1⊸⊑ 𝕩⊸⊏) 𝕨 }
Backward ⇐ ⊣ (InitGrad⟜(¯1⊸⊑) Propagate´ ⊢) TopoSort
