#âŸ¨ValueâŸ© â† â€¢Import "value.bqn"

Tanh â† âŠ‘ â€¢math.Tanh
Add â† +Â´
Mul â† Ã—Â´
Pow â† âŠ‘ â‹†

TanhB â† {
  oâ€¿c â† ğ•¨
  g â† (âŠ¢Ã—1-2â‹†ËœâŠ£)Â´ 2 â†‘ o âŠ ğ•©
  gâŠ¸+âŒ¾(1âŠ¸âŠË˜câŠ¸âŠ) ğ•©
}

AddB â† {
  oâ€¿c â† ğ•¨
  g â† 1 âŠ‘ o âŠ ğ•©
  gâŠ¸+âŒ¾(1âŠ¸âŠË˜câŠ¸âŠ) ğ•©
}

MulB â† {
  oâ€¿c â† ğ•¨
  g â† 1 âŠ‘ o âŠ ğ•©
  gs â† +âŸœ(âŒ½ gâŠ¸Ã—)Â´ <Ë˜ â‰ 1â€¿0âŠ¸âŠË˜ c âŠ ğ•©
  gsâŒ¾(1âŠ¸âŠË˜câŠ¸âŠ) ğ•© # needs further refactoring
}

PowB â† âŠ¢

ops â† âŠ¢â€¿Addâ€¿Mulâ€¿Powâ€¿Tanh
bops â† âŠ¢â€¿AddBâ€¿MulBâ€¿PowBâ€¿TanhB

_apply â† {
  ch â† â¥Šğ•©
  val â† ğ”½ âŠ‘Ë˜ ch âŠ ğ•¨
  op â† âŠ‘ / ğ•— = ops
  ğ•¨ âˆ¾ â‰ valâ€¿0â€¿opâ€¿ch
}

Val â† {
  â‰ ğ•©â€¿0â€¿0â€¿âŸ¨âŸ©
}

Neg â† {
  (ğ•¨ âˆ¾ Val Â¯1) Mul _apply ğ•©â‹ˆâ‰ ğ•¨
}

Sub â† {
  aâ€¿b â† ğ•©
  (ğ•¨ Neg b) Add _apply aâ‹ˆ1+â‰ ğ•¨
}

Topo â† {
  ğ•© âˆ¾ âˆ¾ ğ•¨ Topoâš‡2â€¿0 Â¯1 âŠ‘ ğ•© âŠ ğ•¨
}

BackProp â† {
  val â† ğ•¨ âŠ ğ•©
  back â† bops âŠ‘Ëœ 2 âŠ‘ val
  ğ•© BackËœ ğ•¨ â‹ˆ 3 âŠ‘ val
}

Backward â† {
  t â† ğ•¨ Topo ğ•©
  i â† âŠ‘ t
  w â† 1âŒ¾(1âŠ¸âŠ‘ iâŠ¸âŠ) ğ•¨

  w BackPropÂ´ âŒ½ t
}

mat â† Val 2
mat âˆ¾â†© Val 0
mat âˆ¾â†© Val Â¯3
mat âˆ¾â†© Val 1
mat Mul _applyâ†© 0â€¿2
mat Mul _applyâ†© 1â€¿3
mat Add _applyâ†© 4â€¿5
mat âˆ¾â†© Val 6.8813735870195432
mat Add _applyâ†© 6â€¿7
mat Tanh _applyâ†© 8
mat Negâ†© 9
mat Subâ†© 7â€¿8

mat Backward 9

#x1 â† Value 2.0
#x2 â† Value 0.0
#w1 â† Value Â¯3.0
#w2 â† Value 1.0
#
#x1w1 â† x1.Mul w1
#x2w2 â† x2.Mul w2
#
#x1w1x2w2 â† x1w1.Add x2w2
#
#b â† Value 6.8813735870195432
#
#n â† x1w1x2w2.Add b
#
##o â† n.Tanh@
#e â† (n.Mul Value 2).Exp@
#o â† (e.Sub Value 1).Div (e.Add Value 1)
#
#o.Backward@
#
#!Â¯1.5 â‰¡ x1.Grad@
#!0.5 â‰¡ x2.Grad@
#!1 â‰¡ w1.Grad@
#!0 â‰¡ w2.Grad@
