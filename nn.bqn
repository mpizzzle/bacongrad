âŸ¨ValueâŸ© â† â€¢Import "value.bqn"

#debug â† â€¢BQN âŠ‘ â€¢FLines "debug_weights.txt"

Rand â† {ğ•¤
  (1 -Ëœ 2 Ã— â€¢rand.RangeâŠ¸Ã·) 1 -Ëœ 2 â‹† 32
}

Neuron â† {
  weights â† Valueâˆ˜RandÂ¨ â†•ğ•©
  bias â† Value Rand@

  Call â‡ {
    act â† bias { ğ•¨.Add ğ•© }Â´ weights { ğ•¨.Mul ğ•© }Â¨ ğ•©
    act.Tanh@
  }

  Params â‡ {ğ•¤
    weights âˆ¾ bias
  }
}

Layer â† {
  shapeâ€¿count â† ğ•©
  neurons â† NeuronâŸœshapeÂ¨ â†•count

  Call â‡ {
    (1=â‰ ) â—¶ âŠ¢â€¿âŠ‘ ğ•©âŠ¸{ ğ•©.Call ğ•¨ }Â¨ neurons
  }

  Params â‡ {ğ•¤
    âˆ¾ { ğ•©.Params@ }Â¨ neurons
  }
}

MLP â† {
  layers â† LayerË˜ 2 â†• ğ•©

  Call â‡ {
    ğ•© { ğ•¨.Call ğ•© }Â´ âŒ½ layers
  }

  Params â‡ {ğ•¤
    âˆ¾ { ğ•©.Params@ }Â¨ layers
  }
}

m â† MLP 3â€¿4â€¿4â€¿1
#debug { ğ•©.Da ğ•¨ }Â¨ m.Params@

xs â† Valueâš‡0 âŸ¨2,3,Â¯1âŸ©â€¿âŸ¨3,Â¯1,0.5âŸ©â€¿âŸ¨0.5,1,1âŸ©â€¿âŸ¨1,1,Â¯1âŸ©
ys â† ValueÂ¨ 1â€¿Â¯1â€¿Â¯1â€¿1
yp â† m.CallÂ¨ xs
loss â† { ğ•¨.Add ğ•© }Â´ yp { (ğ•¨.Sub ğ•©).Pow 2 }Â¨ ys

loss.Backward@

{ ğ•©.Da (ğ•©.Data@) + Â¯0.01 Ã— ğ•©.Grad@ }Â¨ m.Params@
â€¢Show loss.Data@

DoThing â† {ğ•¤
  yp â†© m.CallÂ¨ xs
  loss â†© { ğ•¨.Add ğ•© }Â´ yp { (ğ•¨.Sub ğ•©).Pow 2 }Â¨ ys

  { ğ•©.Gr 0 }Â¨ m.Params@
  loss.Backward@

  { ğ•©.Da (ğ•©.Data@) + Â¯0.01 Ã— ğ•©.Grad@ }Â¨ m.Params@
  â€¢Show loss.Data@
}

DoThingâŸ10 @
