âŸ¨ValueâŸ© â† â€¢Import "value.bqn"

R â† {ğ•¤
  (1 -Ëœ 2 Ã— â€¢rand.Range Ã· âŠ¢) 1 -Ëœ 2 â‹† 32
}

Neuron â† {
  w â† (Value R)Â¨ â†•ğ•©
  b â† Value R@
  b.La 'b'

  Call â‡ {
    act â† b { ğ•¨.Add ğ•© }Â´ (w { ğ•¨.Mul ğ•© }Â¨ ğ•©)
    act.Tanh@
  }

  Params â‡ {ğ•¤
   w âˆ¾ b
  }
}

Layer â† {
  dâ€¿c â† ğ•©
  n â† (Neuron dË™)Â¨ â†•c

  Call â‡ {
    ğ•©âŠ¸{ ğ•©.Call ğ•¨ }Â¨ n
  }

  Params â‡ {ğ•¤
    âˆ¾ { ğ•©.Params@ }Â¨ n
  }
}

MLP â† {
  layers â† { Layer ğ•© }Ë˜ 2 â†• ğ•©

  Call â‡ {
    o â† ğ•© { ğ•¨.Call ğ•© }Â´ âŒ½ layers
    (1=â‰ ) â—¶ âŠ¢â€¿âŠ‘ o
  }

  Params â‡ {ğ•¤
    âˆ¾ { ğ•©.Params@ }Â¨ layers
  }
}

#asdf â† (Neuron 2).Call x
#asdf.Gr 1
#> { ğ•©.Show@ }Â¨  asdf.Backward@

#l â† Layer 2â€¿3
#ns â† > { ğ•©.Show@ } Â¨ l.Call ValueÂ¨ 2â€¿3
#> { ğ•©.Backward@ }Â¨ ns

m â† MLP 3â€¿4â€¿4â€¿1

#out â† m.Call ValueÂ¨ 1â€¿2â€¿3
#out.Gr 1
#out.Backward@

xs â† Valueâš‡0 âŸ¨2,3,Â¯1âŸ©â€¿âŸ¨3,Â¯1,0.5âŸ©â€¿âŸ¨0.5,1,1âŸ©â€¿âŸ¨1,1,Â¯1âŸ©
ys â† ValueÂ¨ 1â€¿Â¯1â€¿Â¯1â€¿1

yp â† m.CallÂ¨ xs
loss â† { ğ•¨.Add ğ•© }Â´ yp { (ğ•¨.Sub ğ•©).Pow 2 }Â¨ ys
â€¢Show { ğ•©.Repr@ }Â¨ yp
â€¢Show loss.Repr@

{ ğ•©.Gr 0 }Â¨ m.Params@
loss.Backward@
{ ğ•©.Da (ğ•©.Repr@) + Â¯0.01 Ã— ğ•©.Grad@ }Â¨ m.Params@

yp â†© m.CallÂ¨ xs
loss â†© { ğ•¨.Add ğ•© }Â´ yp { (ğ•¨.Sub ğ•©).Pow 2 }Â¨ ys
â€¢Show { ğ•©.Repr@ }Â¨ yp
â€¢Show loss.Repr@

{ ğ•©.Gr 0 }Â¨ m.Params@
loss.Backward@
{ ğ•©.Da (ğ•©.Repr@) + Â¯0.01 Ã— ğ•©.Grad@ }Â¨ m.Params@

yp â†© m.CallÂ¨ xs
loss â†© { ğ•¨.Add ğ•© }Â´ yp { (ğ•¨.Sub ğ•©).Pow 2 }Â¨ ys
â€¢Show { ğ•©.Repr@ }Â¨ yp
loss.Repr@

x1 â† Value 2.0
x1.La "x1"
#x1.Gr Â¯3.0 Ã— 0.5

x2 â† Value 0.0
x2.La "x2"
#x2.Gr 1.0 Ã— 0.5

w1 â† Value Â¯3.0
w1.La "w1"
#w1.Gr 2.0 Ã— 0.5

w2 â† Value 1.0
w2.La "w2"
#w2.Gr 0.0 Ã— 0.5

x1w1 â† x1.Mul w1
#x1w1.Gr 0.5
x1w1.Show@

x2w2 â† x2.Mul w2
#x2w2.Gr 0.5
x2w2.Show@

x1w1x2w2 â† x1w1.Add x2w2
#x1w1x2w2.Gr 0.5
x1w1x2w2.Show@

b â† Value 6.8813735870195432
b.La "b"
#b.Gr 0.5
b.Show@

n â† x1w1x2w2.Add b
#n.Gr 1 - 2 â‹†Ëœ (n.Tanh@).Repr@

#o â† n.Tanh@
en â† (n.Mul Value 2).Exp@
oo â† (en.Sub Value 1).Div (en.Add Value 1)

oo.Gr 1
> { ğ•©.Show@ }Â¨ oo.Backward@

